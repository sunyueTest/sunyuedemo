/**
 * thingjs数据交互
 * @type {HTMLElement}
 */


//模拟采集器传入数据（3条路线）
var path = [];
//混合
var f = [
    [13.928, 6.01, 11.124],
    [-29.385, 6.01, 11.561],
    [-29.321, 0.01, 17.147],
    [-9.863, 0.01, 17.047],
    [-9.693, 3.01, 14.038],
    [-9.552, 3.01, 12.31],
    [35.333, 3.01, 13.894],
    [35.33, 6.01, 16.817],
    [18.619, 6.01, 16.282]
];

// //一层
// var d = [
//     [ 11.302, 0.01, 13.914],
//     [ 28.796, 0.01, 14.168],
//     [ 56.704, 0.01, 13.501],
//     [ 57.581, 0.01, -7.61],
//     [ 18.03, 0.01, -9.281],
//     [ 11.074, 0.01, 14.39],
//     [ -7.857, 0.01, 14.625],
//     [ -28.909, 0.01, 13.142],
//     [ -29.765, 0.01, -7.849],
//     [ 11.317, 0.01, -9.13],
//     [ 19.146, 0.01, 15.291]
// ];

// //二层
// var e = [
//     [ 7.362, 3.01, 17.383],
//     [ -9.524, 3.01, 12.437],
//     [ -9.231, 3.01, -6.004],
//     [ 23.115, 0.01, -7.471],
//     [ 36.56, 3.01, -5.806],
//     [ 36.327, 3.01, 13.126],
//     [ 17.946, 3.01, 17.31]
// ]

let routes = [];
//混合小地图坐标点
for (let i = 0; i < f.length; i++) {
    if (f[i][1] < 1) {                            //一层
        let x1 = 12 + (30.871 + f[i][0]) / 0.54;
        let y1 = 222 + (11.09 + f[i][2]) / 0.5;
        routes.push({x: x1,z: 1, y: y1});
    } else if (f[i][1] > 1 && f[i][1] < 4) {      //二层
        let x1 = 43 + (10.852 + f[i][0]) / 0.54;
        let y1 = 116 + (10.947 + f[i][2]) / 0.5;
        routes.push({x: x1,z: 2, y: y1});
    } else {                                      //三层
        let x1 = 13 + (30.871 + f[i][0]) / 0.54;
        let y1 = 13 + (11.09 + f[i][2]) / 0.5;
        routes.push({x: x1,z: 3, y: y1});
    }
}

// //二层
// for(let i=0 ; i<e.length; i++){
//     let x1 = 43+(10.852+e[i][0])/0.54;
//     let y1 = 116+(10.947+e[i][2])/0.5;
//     routes.push({x:x1,y:y1});
// }
console.log("routes:", routes);

// var a = [
//     [13.598, 6.01, 11.173],
//     [13.494, 6.01, -3.868],
//     [56.177, 6.01, -3.951],
//     [57.359, 6.01, 12.004],
//     [57.196, 0.01, 16.867],
//     [-9.955, 0.01, 16.713],
//     [-9.68, 3.01, 13.873],
//     [-8.331, 3.01, -6.937],
//     [-7.782, 6.01, -9.613],
//     [13.688, 6.01, -2.829],
//     [14.082, 6.01, 11.667]
// ];
// var b = [
//     [10.904, 0.01, 14.04],
//     [56.367, 0.01, 12.722],
//     [55.092, 0.01, -8.139],
//     [35.295, 0.01, -7.292],
//     [14.033, 0.01, -9.633],
//     [14.091, 6.01, -4.444],
//     [14.405, 6.01, 11.087],
//     [ 13.829, 0.01, 17.202],
//     [ 4.969, 0.01, 17.288]
// ];
// var c = [
//     [14.079, 3.01, 12.467],
//     [-7.623, 3.01, 14.045],
//     [-8.24, 6.01, 17.618],
//     [-29.521, 6.01, 11.572],
//     [-29.4, 6.01, -4.566],
//     [-29.289, 0.01, -9.663],
//     [37.518, 0.01, -9.868],
//     [37.717, 3.01, -6.287],
//     [ 35.424, 3.01, 12.23],
//     [ 30.204, 3.01, 17.133]
// ];
// path.push(a);
// path.push(b);
// path.push(c);
path.push(f);

var iframe = document.getElementById('iframe');
iframe.onload = function () {
    setTimeout(function () {
        //向thingjs传递数据
        var data = {
            path: path,
            routes: routes
        };
        console.log('data: ', data);
        var send = {funcName: 'updateData', param: data};
        iframe.contentWindow.postMessage(send, '*');
    }, 5000);
};

// 监听子页面传回的数据
window.addEventListener('message', function (e) {
    console.log(e);
    var data = e.data;
    var funcName = data.funcName;
    var param = data.param;
    // 调用 本页面方法
    try {
        window[funcName](param);
    } catch (e) {

    }
});
